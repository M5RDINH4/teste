<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Formulário A3 - Yamaha</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />

  <style>
    :root {
      --yamaha-blue: #003366;
      --yamaha-blue-hover: #0055a4;
      --yamaha-red: #d00000;
      --bg-light: #ffffff;
      --bg-dark: #121212;
      --text-light: #f0f0f0;
      --text-dark: #1a1a1a;
      --success: #28a745;
      --error: #dc3545;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }

    /* Tema claro */
    body.light {
      background-color: var(--bg-light);
      color: var(--text-dark);
    }
    body.light .container {
      background-color: var(--bg-light);
      color: var(--text-dark);
    }
    body.light h2,
    body.light label {
      color: var(--yamaha-blue);
    }

    /* Tema escuro */
    body.dark {
      background-color: var(--bg-dark);
      color: var(--text-light);
    }
    body.dark .container {
      background-color: #1e1e1e;
      color: var(--text-light);
    }
    body.dark h2,
    body.dark label {
      color: var(--text-light);
    }

    /* Botão de tema compacto */
    .theme-toggle {
      position: fixed;
      top: 15px;
      right: 15px;
      width: 40px;
      height: 40px;
      font-size: 22px;
      background: none;
      border: none;
      cursor: pointer;
      color: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      border-radius: 50%;
      transition: transform 0.2s;
      z-index: 1000;
    }
    .theme-toggle:hover {
      transform: scale(1.1);
    }

    /* Container geral */
    .container {
      max-width: 500px;
      margin: 60px auto 0; /* deixa espaço para o botão de tema */
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .logo {
      width: 120px;
      margin-bottom: 10px;
    }

    h2 {
      margin: 10px 0;
      font-size: 22px;
      font-weight: bold;
    }

    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
      text-align: left;
    }

    select,
    input[type='text'],
    textarea,
    input[type='file'] {
      width: 100%;
      margin-top: 5px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
      transition: box-shadow 0.3s;
    }

    select:focus,
    input:focus,
    textarea:focus {
      border-color: var(--yamaha-blue);
      outline: none;
      box-shadow: 0 0 6px rgba(0, 51, 102, 0.5);
    }

    button[type='submit'] {
      margin-top: 20px;
      padding: 14px;
      width: 100%;
      background-color: var(--yamaha-blue);
      color: white;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button[type='submit']:hover {
      background-color: var(--yamaha-blue-hover);
    }

    button.loading {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .preview {
      margin-top: 10px;
      max-height: 150px;
      border-radius: 8px;
      object-fit: cover;
      display: none;
    }

    .message {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      font-weight: bold;
      text-align: center;
      display: none;
    }

    .success {
      background: var(--success);
      color: white;
    }

    .error {
      background: var(--error);
      color: white;
    }

    @media (max-width: 600px) {
      .container {
        padding: 15px;
        border-radius: 8px;
      }
      button[type='submit'] {
        font-size: 16px;
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- Botão de alternar tema -->
  <button id="themeToggle" class="theme-toggle" aria-label="Alternar tema">
    <i id="themeIcon" class="fas fa-moon"></i>
  </button>

  <div class="container">
    <!-- Logo Yamaha (coloque sua imagem na pasta assets e ajuste o caminho) -->
    <img src="assets/logo.png" alt="Yamaha" class="logo" />

    <h2><i class="fas fa-clipboard-check"></i> Acompanhamento A3</h2>

    <form
      id="formA3"
      name="formA3"
      method="POST"
      data-netlify="true"
      enctype="multipart/form-data"
      netlify-honeypot="bot-field"
      action="/obrigado"
    >
      <!-- Campo honeypot para bots -->
      <input type="hidden" name="form-name" value="formA3" />
      <p style="display:none;">
        <label>Não preencher <input name="bot-field" /></label>
      </p>

      <label for="controle"><i class="fas fa-list"></i> Controle</label>
      <select id="controle" name="controle" required>
        <option value="">Selecione</option>
      </select>

      <label for="contramedida"><i class="fas fa-wrench"></i> Contramedida</label>
      <select id="contramedida" name="contramedida" required>
        <option value="">Selecione o controle primeiro</option>
      </select>

      <label for="status"><i class="fas fa-flag"></i> Status</label>
      <select id="status" name="status" required>
        <option value="">Selecione</option>
        <option value="OK">OK</option>
        <option value="NG">NG</option>
      </select>

      <div id="ngCampos" style="display: none">
        <label for="obsNG"><i class="fas fa-exclamation-triangle"></i> O que está NG?</label>
        <textarea name="obsNG" rows="4"></textarea>

        <label for="foto"><i class="fas fa-camera"></i> Foto </label>
        <input
          type="file"
          name="foto"
          id="foto"
          accept="image/*"
          capture="environment"
        />
        <img id="preview" class="preview" />
      </div>

      <!-- Campos ocultos para datas automáticas -->
      <input type="hidden" name="dataVerificacao" id="dataVerificacao" />
      <input type="hidden" name="proximaVerificacao" id="proximaVerificacao" />

      <button type="submit" id="submitBtn">
        <i class="fas fa-paper-plane"></i> Enviar
      </button>
    </form>

    <div id="mensagem" class="message"></div>
  </div>

  <script>
    // Tema
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('theme');
    const body = document.body;
    const themeIcon = document.getElementById('themeIcon');

    function applyTheme(theme) {
      body.classList.remove('light', 'dark');
      body.classList.add(theme);
      themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    }

    if (savedTheme) {
      applyTheme(savedTheme);
    } else {
      applyTheme(prefersDark ? 'dark' : 'light');
    }

    document.getElementById('themeToggle').addEventListener('click', () => {
      const newTheme = body.classList.contains('dark') ? 'light' : 'dark';
      applyTheme(newTheme);
      localStorage.setItem('theme', newTheme);
    });

    // Dados do formulário
    const dados = {
      'A3 0011-24': [
        'MATERIAL, MÉTODO DE FIXAÇÃO E NÚMERO DE BICOS FORAM REAVALIADOS',
        'NOVO MÉTODO DE DIRECIONAMENTO FOI AVALIADO',
        'CHECAGEM DO DISPOSITIVO ATUALIZADA',
        'TREINAMENTO EVIDENCIADO',
        'SEI ABERTA PARA INCLUSÃO DE PNP',
        'COTAÇÃO REALIZADA',
      ],
      'A3 0011-25': [
        'DESCARTE DE INSTRUMENTOS NÃO CONFORMES E OBSOLETOS',
        'IDENTIFICAÇÃO DE ANÉIS PADRÕES DE OGIVA DE MEDIÇÃO DO VIRABREQUIM',
        'ELABORAÇÃO DE LISTA DE INSTRUMENTOS DE MEDIÇÃO UTILIZADOS PELO OPERADOR',
        'ABERTURA DE SEI PARA IDENTIFICAÇÃO DE Nº DE GPI EM ANÉIS PADRÃO PARA ZERAMENTO DE OGIVA',
        'AQUISIÇÃO DE ANEL PADRÃO DE DIMENSÃO CORRETA PARA PROCESSO',
      ],
    };

    const controleSelect = document.getElementById('controle');
    const contramedidaSelect = document.getElementById('contramedida');
    const statusSelect = document.getElementById('status');
    const ngCampos = document.getElementById('ngCampos');
    const preview = document.getElementById('preview');
    const fotoInput = document.getElementById('foto');
    const mensagem = document.getElementById('mensagem');
    const submitBtn = document.getElementById('submitBtn');

    // Preenche dropdown de controle
    Object.keys(dados).forEach((controle) => {
      const opt = document.createElement('option');
      opt.value = controle;
      opt.textContent = controle;
      controleSelect.appendChild(opt);
    });

    // Atualiza contramedidas
    controleSelect.addEventListener('change', () => {
      const contras = dados[controleSelect.value] || [];
      contramedidaSelect.innerHTML = '<option value="">Selecione</option>';
      contras.forEach((item) => {
        const opt = document.createElement('option');
        opt.value = item;
        opt.textContent = item;
        contramedidaSelect.appendChild(opt);
      });
    });

    // Mostra campos NG
    statusSelect.addEventListener('change', () => {
      ngCampos.style.display = statusSelect.value === 'NG' ? 'block' : 'none';
    });

    // Preview da imagem
    fotoInput.addEventListener('change', () => {
      const file = fotoInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        preview.style.display = 'none';
      }
    });

    // Adiciona datas automáticas antes do submit
    document.getElementById('formA3').addEventListener('submit', (e) => {
      // dataVerificacao = agora
      document.getElementById('dataVerificacao').value = new Date().toISOString();
      // proximaVerificacao = +30 dias
      const proxima = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000);
      document.getElementById('proximaVerificacao').value = proxima.toISOString();

      // Mostra loading no botão (visual)
      submitBtn.classList.add('loading');
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
    });

    // Como o Netlify redireciona para página de sucesso, o reset e mensagem você pode colocar na thank you page.
  </script>
</body>
</html>

