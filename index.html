<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Formulário A3 - Yamaha</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Font Awesome para ícones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --yamaha-blue: #003366;
      --yamaha-blue-hover: #0055A4;
      --yamaha-red: #D00000;
      --bg-light: #ffffff;
      --bg-dark: #121212;
      --text-light: #f0f0f0;
      --text-dark: #1a1a1a;
      --success: #28a745;
      --error: #dc3545;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }

    /* Tema claro/escuro automático */
    @media (prefers-color-scheme: dark) {
      body { background-color: var(--bg-dark); color: var(--text-light); }
      .container { background-color: #1e1e1e; color: var(--text-light); }
      h2, label { color: var(--text-light); }
    }

    @media (prefers-color-scheme: light) {
      body { background-color: var(--bg-light); color: var(--text-dark); }
      .container { background-color: var(--bg-light); color: var(--text-dark); }
      h2, label { color: var(--yamaha-blue); }
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }

    .logo {
      width: 120px;
      margin-bottom: 10px;
    }

    h2 {
      margin: 10px 0;
      font-size: 22px;
      font-weight: bold;
    }

    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
      text-align: left;
    }

    select, input[type="text"], textarea, input[type="file"] {
      width: 100%;
      margin-top: 5px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
      transition: box-shadow 0.3s;
    }

    select:focus, input:focus, textarea:focus {
      border-color: var(--yamaha-blue);
      outline: none;
      box-shadow: 0 0 6px rgba(0, 51, 102, 0.5);
    }

    button {
      margin-top: 20px;
      padding: 14px;
      width: 100%;
      background-color: var(--yamaha-blue);
      color: white;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover { background-color: var(--yamaha-blue-hover); }
    button.loading { opacity: 0.7; cursor: not-allowed; }

    .preview {
      margin-top: 10px;
      max-height: 150px;
      border-radius: 8px;
      object-fit: cover;
      display: none;
    }

    .message {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      font-weight: bold;
      text-align: center;
    }

    .success { background: var(--success); color: white; }
    .error { background: var(--error); color: white; }

    @media (max-width: 600px) {
      .container { padding: 15px; border-radius: 8px; }
      button { font-size: 16px; padding: 12px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Logo Yamaha -->
    <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Yamaha_Motor_Logo.svg" alt="Yamaha Logo" class="logo">
    
    <h2><i class="fas fa-clipboard-check"></i> Acompanhamento A3</h2>

    <form id="formA3">
      <label for="controle"><i class="fas fa-list"></i> Controle</label>
      <select id="controle" name="controle" required>
        <option value="">Selecione</option>
      </select>

      <label for="contramedida"><i class="fas fa-wrench"></i> Contramedida</label>
      <select id="contramedida" name="contramedida" required>
        <option value="">Selecione o controle primeiro</option>
      </select>

      <label for="status"><i class="fas fa-flag"></i> Status</label>
      <select id="status" name="status" required>
        <option value="">Selecione</option>
        <option value="OK">OK</option>
        <option value="NG">NG</option>
      </select>

      <div id="ngCampos" style="display:none;">
        <label for="obsNG"><i class="fas fa-exclamation-triangle"></i> O que está NG?</label>
        <textarea name="obsNG" rows="4"></textarea>

        <label for="foto"><i class="fas fa-camera"></i> Foto (opcional)</label>
        <input type="file" name="foto" id="foto" accept="image/*" capture="environment">
        <img id="preview" class="preview" />
      </div>

      <button type="submit" id="submitBtn"><i class="fas fa-paper-plane"></i> Enviar</button>
    </form>

    <div id="mensagem" class="message hidden"></div>
  </div>

  <script>
    const dados = {
      "A3 0011-24": [
        "MATERIAL, MÉTODO DE FIXAÇÃO E NÚMERO DE BICOS FORAM REAVALIADOS",
        "NOVO MÉTODO DE DIRECIONAMENTO FOI AVALIADO",
        "CHECAGEM DO DISPOSITIVO ATUALIZADA",
        "TREINAMENTO EVIDENCIADO",
        "SEI ABERTA PARA INCLUSÃO DE PNP",
        "COTAÇÃO REALIZADA"
      ],
      "A3 0011-25": [
        "DESCARTE DE INSTRUMENTOS NÃO CONFORMES E OBSOLETOS",
        "IDENTIFICAÇÃO DE ANÉIS PADRÕES DE OGIVA DE MEDIÇÃO DO VIRABREQUIM",
        "ELABORAÇÃO DE LISTA DE INSTRUMENTOS DE MEDIÇÃO UTILIZADOS PELO OPERADOR",
        "ABERTURA DE SEI PARA IDENTIFICAÇÃO DE Nº DE GPI EM ANÉIS PADRÃO PARA ZERAMENTO DE OGIVA",
        "AQUISIÇÃO DE ANEL PADRÃO DE DIMENSÃO CORRETA PARA PROCESSO"
      ]
    };

    const controleSelect = document.getElementById("controle");
    const contramedidaSelect = document.getElementById("contramedida");
    const statusSelect = document.getElementById("status");
    const ngCampos = document.getElementById("ngCampos");
    const preview = document.getElementById("preview");
    const fotoInput = document.getElementById("foto");
    const mensagem = document.getElementById("mensagem");
    const submitBtn = document.getElementById("submitBtn");

    // Preenche o dropdown de controle
    Object.keys(dados).forEach(controle => {
      const opt = document.createElement("option");
      opt.value = controle;
      opt.textContent = controle;
      controleSelect.appendChild(opt);
    });

    // Atualiza contramedidas conforme controle selecionado
    controleSelect.addEventListener("change", () => {
      const contras = dados[controleSelect.value] || [];
      contramedidaSelect.innerHTML = '<option value="">Selecione</option>';
      contras.forEach(item => {
        const opt = document.createElement("option");
        opt.value = item;
        opt.textContent = item;
        contramedidaSelect.appendChild(opt);
      });
    });

    // Mostra/oculta campos NG
    statusSelect.addEventListener("change", () => {
      ngCampos.style.display = (statusSelect.value === "NG") ? "block" : "none";
    });

    // Preview da imagem
    fotoInput.addEventListener("change", () => {
      const file = fotoInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          preview.src = e.target.result;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);
      } else {
        preview.style.display = "none";
      }
    });

    // Envio do formulário
    document.getElementById("formA3").addEventListener("submit", async (e) => {
      e.preventDefault();
      submitBtn.classList.add("loading");
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';

      const formData = new FormData(e.target);
      const payload = Object.fromEntries(formData.entries());
      payload.dataVerificacao = new Date().toISOString();
      payload.proximaVerificacao = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString();

      if (fotoInput.files[0]) {
        const reader = new FileReader();
        reader.onload = async e => {
          payload.foto = e.target.result;
          await enviarDados(payload);
        };
        reader.readAsDataURL(fotoInput.files[0]);
      } else {
        await enviarDados(payload);
      }
    });

    async function enviarDados(payload) {
      try {
        await fetch("URL_DO_SEU_WEBHOOK", {
          method: "POST",
          body: JSON.stringify(payload),
          headers: { "Content-Type": "application/json" }
        });

        mensagem.textContent = "Enviado com sucesso!";
        mensagem.className = "message success";
        mensagem.classList.remove("hidden");

        // Reseta o formulário e oculta tudo
        document.getElementById("formA3").reset();
        preview.style.display = "none";
        ngCampos.style.display = "none";

        // Remove a mensagem depois de 3s
        setTimeout(() => {
          mensagem.classList.add("hidden");
        }, 3000);

      } catch (error) {
        mensagem.textContent = "Erro ao enviar!";
        mensagem.className = "message error";
        mensagem.classList.remove("hidden");

        setTimeout(() => {
          mensagem.classList.add("hidden");
        }, 3000);

      } finally {
        submitBtn.classList.remove("loading");
        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar';
      }
    }
  </script>
</body>
</html>
